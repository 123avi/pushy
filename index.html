<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Pushy by relayrides</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Pushy</h1>
        <p>A Java library for sending push notifications</p>

        <h2>Releases</h2>
        
        <h3>Pushy v0.1 - August 16, 2013</h3>

        <ul>
          <li><a href="https://github.com/relayrides/pushy/releases/download/pushy-0.1/pushy-0.1.jar">Download <strong>JAR file</strong></a></li>
          <li><a href="https://github.com/relayrides/pushy/archive/pushy-0.1.tar.gz">Download <strong>source code</strong></a></li>
          <li><a href="http://relayrides.github.io/pushy/apidocs/0.1/">View <strong>API docs</strong></a></li>
        </ul>
      </header>
      <section>
        <p>Pushy is a Java library for sending <a href="http://developer.apple.com/library/mac/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/Introduction.html">APNs</a> (iOS and OS X) push notifications. It is written and maintained by the engineers at <a href="https://relayrides.com/">RelayRides</a> and is built on the <a href="http://netty.io/">Netty framework</a>.</p>

<p>Pushy was created because we found that the other APNs libraries for Java simply didn't meet our needs in terms of reliability or performance. Pushy distinguishes itself from other libraries with several important features:</p>

<ul>
<li>Asynchronous network IO (via Netty) for maximum performance</li>
<li>Efficient connection management (other libraries appear to reconnect to the APNs gateway far more frequently than is really necessary)</li>
<li>Graceful handling and reporting of permanent notification rejections</li>
<li>Thorough <a href="http://relayrides.github.io/pushy/apidocs/0.1/">documentation</a></li>
</ul><p>We believe that Pushy is already the best tool for sending APNs push notifications from Java applications, and we hope you'll help us make it even better via bug reports and pull requests. Thanks!</p>

<h2>
<a name="getting-started" class="anchor" href="#getting-started"><span class="octicon octicon-link"></span></a>Getting started</h2>

<p>The main public-facing part of Pushy is the <a href="http://relayrides.github.io/pushy/apidocs/0.1/com/relayrides/pushy/apns/PushManager.html"><code>PushManager</code></a> class, which manages connections to APNs and manages the queue of outbound notifications. Before you can create a <code>PushManager</code>, though, you'll need appropriate SSL certificates and keys from Apple. They can be obtained by following the steps in Apple's <a href="http://developer.apple.com/library/mac/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/Chapters/ProvisioningDevelopment.html#//apple_ref/doc/uid/TP40008194-CH104-SW1">"Provisioning and Development"</a> guide.</p>

<p>Once you have your certificates and keys, you can construct a new <code>PushManager</code> like this:</p>

<div class="highlight"><pre><span class="kd">final</span> <span class="n">String</span> <span class="n">keystorePassword</span> <span class="o">=</span> <span class="s">"mySecretPassword"</span><span class="o">;</span>
<span class="kd">final</span> <span class="n">FileInputStream</span> <span class="n">keystoreInputStream</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="s">"/path/to/certificate.p12"</span><span class="o">);</span>

<span class="k">try</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">KeyStore</span> <span class="n">keyStore</span> <span class="o">=</span> <span class="n">KeyStore</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="s">"PKCS12"</span><span class="o">);</span>
    <span class="n">keyStore</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="n">keystoreInputStream</span><span class="o">,</span> <span class="n">keystorePassword</span><span class="o">.</span><span class="na">toCharArray</span><span class="o">());</span>

    <span class="kd">final</span> <span class="n">PushManager</span><span class="o">&lt;</span><span class="n">SimpleApnsPushNotification</span><span class="o">&gt;</span> <span class="n">pushManager</span> <span class="o">=</span>
        <span class="k">new</span> <span class="n">PushManager</span><span class="o">&lt;</span><span class="n">SimpleApnsPushNotification</span><span class="o">&gt;(</span>
            <span class="n">ApnsEnvironment</span><span class="o">.</span><span class="na">getSandboxEnvironment</span><span class="o">(),</span> <span class="n">keyStore</span><span class="o">,</span> <span class="n">keystorePassword</span><span class="o">);</span>

    <span class="n">pushManager</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
    <span class="n">keystoreInputStream</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>

<p>Once you have your <code>PushManager</code> constructed and started, you're ready to start constructing and sending push notifications. Pushy provides a number of utility classes for working with APNs tokens and payloads. Here's an example:</p>

<div class="highlight"><pre><span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">token</span> <span class="o">=</span> <span class="n">TokenUtil</span><span class="o">.</span><span class="na">tokenStringToByteArray</span><span class="o">(</span>
    <span class="s">"&lt;5f6aa01d 8e335894 9b7c25d4 61bb78ad 740f4707 462c7eaf bebcf74f a5ddb387&gt;"</span><span class="o">);</span>

<span class="kd">final</span> <span class="n">ApnsPayloadBuilder</span> <span class="n">payloadBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ApnsPayloadBuilder</span><span class="o">();</span>

<span class="n">payloadBuilder</span><span class="o">.</span><span class="na">setAlertBody</span><span class="o">(</span><span class="s">"Ring ring, Neo."</span><span class="o">);</span>
<span class="n">payloadBuilder</span><span class="o">.</span><span class="na">setSoundFileName</span><span class="o">(</span><span class="s">"ring-ring.aiff"</span><span class="o">);</span>

<span class="kd">final</span> <span class="n">String</span> <span class="n">payload</span> <span class="o">=</span> <span class="n">payloadBuilder</span><span class="o">.</span><span class="na">buildWithDefaultMaximumLength</span><span class="o">();</span>

<span class="n">pushManager</span><span class="o">.</span><span class="na">enqueuePushNotification</span><span class="o">(</span>
        <span class="k">new</span> <span class="nf">SimpleApnsPushNotification</span><span class="o">(</span><span class="n">token</span><span class="o">,</span> <span class="n">payload</span><span class="o">));</span>
</pre></div>

<p>When you're done sending push notifications, make sure to shut down the <code>PushManager</code>:</p>

<div class="highlight"><pre><span class="n">List</span><span class="o">&lt;</span><span class="n">SimpleApnsPushNotification</span><span class="o">&gt;</span> <span class="n">unsentNotifications</span> <span class="o">=</span> <span class="n">pushManager</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
</pre></div>

<p>Note that there's no guarantee as to when a push notification will be sent after it's enqueued. Shutting down the <code>PushManager</code> returns a list of notifications still in the outbound queue so you'll know what hasn't been transmitted to APNs.</p>

<h2>
<a name="error-handling" class="anchor" href="#error-handling"><span class="octicon octicon-link"></span></a>Error handling</h2>

<p>Push notification providers communicate with APNs by opening a long-lived connection to Apple's push notification gateway and streaming push notification through that connection. Apple's gateway won't respond or acknowledge push notifications unless something goes wrong, in which case it will send an error code and close the connection (don't worry -- Pushy deals with all of this for you). To deal with notifications that are rejected by APNs, Pushy provides a notion of a <a href="http://relayrides.github.io/pushy/apidocs/0.1/com/relayrides/pushy/apns/RejectedNotificationListener.html"><code>RejectedNotificationListener</code></a>. Rejected notification listeners are informed whenever APNs rejects a push notification. Here's an example of registering a simple listener:</p>

<div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyRejectedNotificationListener</span> <span class="kd">implements</span> <span class="n">RejectedNotificationListener</span><span class="o">&lt;</span><span class="n">SimpleApnsPushNotification</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleRejectedNotification</span><span class="o">(</span><span class="n">SimpleApnsPushNotification</span> <span class="n">notification</span><span class="o">,</span> <span class="n">RejectedNotificationException</span> <span class="n">cause</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"%s was rejected with error code %s\n"</span><span class="o">,</span> <span class="n">notification</span><span class="o">,</span> <span class="n">cause</span><span class="o">.</span><span class="na">getReason</span><span class="o">());</span>
    <span class="o">}</span>

<span class="o">}</span>

<span class="c1">// ...</span>

<span class="n">pushManager</span><span class="o">.</span><span class="na">registerRejectedNotificationListener</span><span class="o">(</span><span class="k">new</span> <span class="n">MyRejectedNotificationListener</span><span class="o">());</span>
</pre></div>

<p>Lots of things can go wrong when sending notifications, but rejected notification listeners are only informed when Apple definitively rejects a push notification. All other IO problems are treated as temporary issues, and Pushy will automatically re-transmit notifications affected by IO problems later.</p>

<h2>
<a name="the-feedback-service" class="anchor" href="#the-feedback-service"><span class="octicon octicon-link"></span></a>The feedback service</h2>

<p>Apple also provides a "feedback service" as part of APNs. The feedback service reports which tokens are no longer valid because the end user uninstalled the receiving app. Apple requires push notification providers to poll for expired tokens on a daily basis. See <a href="http://developer.apple.com/library/mac/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/Chapters/CommunicatingWIthAPS.html#//apple_ref/doc/uid/TP40008194-CH101-SW3">"The Feedback Service"</a> for additional details from Apple.</p>

<p>To get expired device tokens with Pushy:</p>

<div class="highlight"><pre><span class="k">for</span> <span class="o">(</span><span class="kd">final</span> <span class="n">ExpiredToken</span> <span class="n">expiredToken</span> <span class="o">:</span> <span class="n">pushManager</span><span class="o">.</span><span class="na">getExpiredTokens</span><span class="o">())</span> <span class="o">{</span>
    <span class="c1">// Stop sending push notifications to each expired token if the expiration</span>
    <span class="c1">// time is after the last time the app registered that token.</span>
<span class="o">}</span>
</pre></div>

<h2>
<a name="license-and-status" class="anchor" href="#license-and-status"><span class="octicon octicon-link"></span></a>License and status</h2>

<p>Pushy is available to the public under the <a href="http://opensource.org/licenses/MIT">MIT License</a>.</p>

<p>The current version of Pushy is <a href="https://github.com/relayrides/pushy/releases/tag/pushy-0.1">0.1</a>. We consider it to be fully functional (and use it in production!), but the public API may change significantly before a 1.0 release.</p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://relayrides.com/">RelayRides</a>. View the <a href="https://github.com/relayrides/pushy">project on GitHub</a>.</p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>